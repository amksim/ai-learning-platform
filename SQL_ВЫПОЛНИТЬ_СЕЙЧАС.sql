-- ✅ ЭТОТ SQL НУЖНО ВЫПОЛНИТЬ В SUPABASE ПРЯМО СЕЙЧАС!

-- ========================================
-- ШАГ 1: ПРОВЕРЯЕМ ТЕКУЩЕЕ СОСТОЯНИЕ
-- ========================================
-- Смотрим какие уроки бесплатные, какие платные
SELECT id, title, is_free 
FROM courses 
ORDER BY id 
LIMIT 10;

-- Должны увидеть что-то типа:
-- id | title   | is_free
-- 1  | Урок 1  | true/false
-- 2  | Урок 2  | true/false
-- 3  | Урок 3  | true/false
-- 4  | Урок 4  | true/false
-- 5  | Урок 5  | true/false
-- 6  | Урок 6  | true/false  ← ЭТОТ ВЫЗЫВАЕТ ПРОБЛЕМУ!


-- ========================================
-- ШАГ 2: ИСПРАВЛЯЕМ - ПЕРВЫЕ 3 УРОКА БЕСПЛАТНЫЕ
-- ========================================
-- Устанавливаем первые 3 урока как БЕСПЛАТНЫЕ (доступны без оплаты)
UPDATE courses 
SET is_free = true 
WHERE id IN (1, 2, 3);

-- Результат: Уроки 1, 2, 3 теперь доступны ВСЕМ без регистрации и оплаты


-- ========================================
-- ШАГ 3: ВСЕ ОСТАЛЬНЫЕ УРОКИ ПЛАТНЫЕ
-- ========================================
-- Устанавливаем все остальные уроки как ПЛАТНЫЕ (требуют оплату)
UPDATE courses 
SET is_free = false 
WHERE id > 3;

-- Результат: Уроки 4, 5, 6, 7, 8... требуют оплату курса


-- ========================================
-- ШАГ 4: ПРОВЕРЯЕМ РЕЗУЛЬТАТ
-- ========================================
SELECT id, title, is_free 
FROM courses 
ORDER BY id 
LIMIT 20;

-- Должно быть:
-- id | title   | is_free
-- 1  | Урок 1  | true   ✅
-- 2  | Урок 2  | true   ✅
-- 3  | Урок 3  | true   ✅
-- 4  | Урок 4  | false  ❌ (требует оплату)
-- 5  | Урок 5  | false  ❌ (требует оплату)
-- 6  | Урок 6  | false  ❌ (требует оплату)
-- 7  | Урок 7  | false  ❌ (требует оплату)
-- ... и так далее


-- ========================================
-- ШАГ 5: ПРОВЕРЯЕМ ПРОФИЛИ
-- ========================================
-- Проверяем что в таблице profiles есть нужные поля
SELECT id, email, subscription_status, subscription_end_date 
FROM profiles 
LIMIT 5;

-- Должно быть:
-- id        | email           | subscription_status | subscription_end_date
-- uuid-xxx  | test@email.com  | free               | null
-- uuid-yyy  | admin@email.com | premium            | 2025-12-10


-- ========================================
-- ГОТОВО!
-- ========================================

-- ✅ После выполнения этого SQL:
-- 1. Уроки 1-3 = БЕСПЛАТНЫЕ (доступны всем без входа)
-- 2. Уроки 4+ = ПЛАТНЫЕ (требуют оплату)
-- 3. После оплаты subscription_status = 'premium' → ВСЕ уроки доступны
-- 4. Новые уроки добавленные через админку будут is_free = false по умолчанию → требуют оплату
-- 5. Один раз оплатил → навсегда доступ ко ВСЕМ урокам (включая будущие)

-- ⚠️ ВАЖНО: После выполнения SQL перезагрузи страницу в браузере (Cmd+Shift+R)
